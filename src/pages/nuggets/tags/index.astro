---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import { Tag } from 'lucide-astro';

const allNuggets = await getCollection('nuggets', ({ data }) => {
  return data.published !== false;
});

// Count posts per tag
const tagCounts = new Map<string, number>();
allNuggets.forEach(nugget => {
  nugget.data.tags.forEach(tag => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

// Sort tags by count (descending) then alphabetically
const sortedTags = Array.from(tagCounts.entries())
  .sort((a, b) => {
    if (b[1] !== a[1]) return b[1] - a[1]; // Sort by count descending
    return a[0].localeCompare(b[0]); // Then alphabetically
  });
---

<Layout 
  title="Topics - Farhan Hasin Chowdhury"
  description="Explore all topics covered in my engineering nuggets. From backend development to AI, distributed systems to API design."
>
  <div class="min-h-screen bg-background text-foreground">
    <Header />
    
    <main id="main-content">
      <section class="py-20 px-6 pt-32">
        <div class="max-w-4xl mx-auto">
          <!-- Header -->
          <div class="mb-12">
            <a
              href="/nuggets"
              class="inline-flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors mb-6"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m15 18-6-6 6-6"/>
              </svg>
              All Nuggets
            </a>
            
            <h1 class="mb-4 text-foreground">All Topics</h1>
            <p class="text-muted-foreground text-lg">
              Browse {sortedTags.length} topic{sortedTags.length !== 1 ? 's' : ''} across {allNuggets.length} engineering nugget{allNuggets.length !== 1 ? 's' : ''}
            </p>
          </div>

          <!-- Tags Grid -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {sortedTags.map(([tag, count]) => (
              <a 
                href={`/nuggets/tags/${tag}`}
                class="group p-6 rounded-lg border border-border bg-muted/30 hover:border-primary hover:bg-muted/50 transition-all"
              >
                <div class="flex items-start justify-between gap-3 mb-3">
                  <div class="flex items-center gap-2 text-primary">
                    <Tag size={20} />
                    <h3 class="text-lg font-semibold group-hover:text-primary transition-colors">
                      {tag}
                    </h3>
                  </div>
                  <span class="inline-flex items-center justify-center rounded-full bg-primary/10 text-primary px-2.5 py-0.5 text-sm font-medium">
                    {count}
                  </span>
                </div>
                <p class="text-sm text-muted-foreground">
                  {count} post{count !== 1 ? 's' : ''}
                </p>
              </a>
            ))}
          </div>
        </div>
      </section>
    </main>

    <Footer />
  </div>
</Layout>
