---
import { getCollection } from 'astro:content';
import { Calendar, Clock } from 'lucide-astro';

// Get all published nuggets, sorted by date (newest first)
const allNuggets = await getCollection('nuggets', ({ data }) => {
  return data.published !== false;
});

const nuggets = allNuggets.sort((a, b) => {
  return b.data.date.getTime() - a.data.date.getTime();
});
---

<section class="py-20 px-6 pt-32">
  <div class="max-w-4xl mx-auto">
    <div class="mb-12 text-center">
      <h2 class="mb-4 text-foreground">Engineering Nuggets</h2>
      <p class="text-muted-foreground text-lg">
        Short, high-signal insights on backend and AI engineering. One core idea, code snippet, and takeaway.
      </p>
    </div>

    <div class="space-y-6">
      {nuggets.map((nugget) => {
        const primaryTag = nugget.data.tags[0];
        return (
          <a 
            href={`/nuggets/${nugget.slug}`}
            class="block p-6 rounded-lg border border-border bg-muted/30 hover:border-primary transition-all group"
          >
            <div class="flex flex-wrap items-center gap-3 mb-3">
              <span class={`inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium ${
                primaryTag === 'Backend' 
                  ? 'bg-primary border-transparent text-primary-foreground' 
                  : 'bg-accent border-transparent text-primary-foreground'
              }`}>
                {primaryTag}
              </span>
              <div class="flex items-center gap-4 text-sm text-muted-foreground">
                <span class="flex items-center gap-1">
                  <Calendar size={14} />
                  {nugget.data.date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                  })}
                </span>
                <span class="flex items-center gap-1">
                  <Clock size={14} />
                  {nugget.data.readTime}
                </span>
              </div>
            </div>
            
            <h3 class="mb-2 text-foreground group-hover:text-primary transition-colors">
              {nugget.data.title}
            </h3>
            
            <p class="text-muted-foreground">
              {nugget.data.summary}
            </p>
          </a>
        );
      })}
    </div>
  </div>
</section>
