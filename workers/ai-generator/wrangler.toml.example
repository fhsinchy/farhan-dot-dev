name = "ai-nugget-generator"
main = "src/index.ts"
compatibility_date = "2025-10-30"
compatibility_flags = ["nodejs_compat"]

# Cron triggers
# - Mon/Wed/Fri 09:00 UTC: Generate new content
# - Tue/Thu 09:00 UTC: Check PR merge status
[triggers]
crons = [
	"0 9 * * 1,3,5", # Monday, Wednesday, Friday - content generation
	"0 9 * * 2,4"    # Tuesday, Thursday - PR status check
]

# KV namespace for idea seeds and generation logs
# Create via: wrangler kv:namespace create "NUGGET_STORE"
[[kv_namespaces]]
binding = "NUGGET_STORE"
id = "YOUR_NUGGET_STORE_KV_NAMESPACE_ID" # Replace with actual KV namespace ID after creation

# KV namespace for idea queue (Stage 1: scheduler)
# Create via: wrangler kv:namespace create "IDEA_QUEUE"
[[kv_namespaces]]
binding = "IDEA_QUEUE"
id = "YOUR_IDEA_QUEUE_KV_NAMESPACE_ID" # Replace with actual KV namespace ID after creation

# Environment variables (use wrangler secret for sensitive values)
[vars]
GITHUB_REPO = "fhsinchy/farhan-dot-dev"
GITHUB_BRANCH_PREFIX = "nuggets"

# Secrets to set via CLI:
# wrangler secret put OPENAI_API_KEY
# wrangler secret put GITHUB_TOKEN

# Worker route (optional - can also use workers.dev subdomain)
# routes = [
#   { pattern = "farhan.dev/ai/*", zone_name = "farhan.dev" }
# ]

# Development settings
[dev]
port = 8787

[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1