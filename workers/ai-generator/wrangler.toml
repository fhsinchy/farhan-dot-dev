name = "ai-nugget-generator"
main = "src/index.ts"
compatibility_date = "2025-10-30"
compatibility_flags = ["nodejs_compat"]

# Cron triggers
# - Mon/Wed/Fri 09:00 UTC: Generate new content
# - Tue/Thu 09:00 UTC: Check PR merge status
[triggers]
crons = [
	"0 9 * * 1,3,5", # Monday, Wednesday, Friday - content generation
	"0 9 * * 2,4"    # Tuesday, Thursday - PR status check
]

# KV namespace for idea seeds and generation logs
[[kv_namespaces]]
binding = "NUGGET_STORE"
id = "da62f46128c34684b5c9109d4d631b17" # Replace with actual KV namespace ID after creation

# KV namespace for idea queue (Stage 1: scheduler)
[[kv_namespaces]]
binding = "IDEA_QUEUE"
id = "d646eaf4159d4f41a6530475a3def064" # TODO: Create via `wrangler kv:namespace create "IDEA_QUEUE"` and update this ID

# Environment variables (use wrangler secret for sensitive values)
[vars]
GITHUB_REPO = "fhsinchy/farhan-dot-dev"
GITHUB_BRANCH_PREFIX = "nuggets"
RATE_LIMIT_PER_HOUR = "10"

# Secrets to set via CLI:
# wrangler secret put OPENAI_API_KEY
# wrangler secret put GITHUB_TOKEN
# wrangler secret put WORKER_API_KEY

# Worker route (optional - can also use workers.dev subdomain)
# routes = [
#   { pattern = "farhan.dev/ai/*", zone_name = "farhan.dev" }
# ]

# Development settings
[dev]
port = 8787
